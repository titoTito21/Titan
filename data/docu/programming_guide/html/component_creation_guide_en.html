<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titan Component Creation Guide - TCE Launcher Programming Guide</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --bg-color: #ffffff;
            --text-color: #1f2937;
            --code-bg: #f3f4f6;
            --sidebar-bg: #f9fafb;
            --border-color: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        .sidebar nav ul {
            list-style: none;
        }

        .sidebar nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar nav a {
            color: var(--text-color);
            text-decoration: none;
            display: block;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .sidebar nav a:hover {
            background-color: var(--code-bg);
        }

        .sidebar nav a.active {
            background-color: var(--primary-color);
            color: white;
        }

        .content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem 3rem;
            max-width: 1200px;
        }

        .content h1 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-color);
            font-size: 2.5rem;
        }

        .content h2 {
            color: var(--secondary-color);
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .content h3 {
            color: var(--text-color);
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
        }

        .content h4 {
            color: var(--text-color);
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .content p {
            margin-bottom: 1rem;
        }

        .content ul, .content ol {
            margin-bottom: 1rem;
            margin-left: 2rem;
        }

        .content li {
            margin-bottom: 0.5rem;
        }

        .content code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }

        .content pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }

        .content pre code {
            background: none;
            padding: 0;
            font-size: 0.875rem;
        }

        .doc-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .doc-table th {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }

        .doc-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .doc-table tr:hover {
            background: var(--code-bg);
        }

        .content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .content a:hover {
            text-decoration: underline;
        }

        .content blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #6b7280;
            font-style: italic;
        }

        .header-banner {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 1rem 3rem;
            margin: -2rem -3rem 2rem -3rem;
        }

        .header-banner h1 {
            color: white;
            border: none;
            padding: 0;
            margin: 0;
        }

        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .back-to-top:hover {
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .content {
                margin-left: 0;
                padding: 1.5rem;
            }

            .header-banner {
                margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h2>TCE Launcher<br>Programming Guide</h2>
            <nav>
                <ul>
                    <li style="border-top: 1px solid var(--border-color); padding-top: 0.5rem; margin-top: 0.5rem;"><a href="index_pl.html">Polski version</a></li>
<li><a href="component_creation_guide_en.html" class="active">Creating Components</a></li>
<li><a href="widget_creation_guide_en.html">Creating Widgets</a></li>
<li><a href="statusbar_applet_guide_en.html">Statusbar Applets</a></li>
<li><a href="titanim_module_guide_en.html">Titan IM Modules</a></li>
<li><a href="app_creation_guide_en.html">Creating Applications</a></li>
<li><a href="game_creation_guide_en.html">Creating Games</a></li>
                </ul>
            </nav>
        </aside>

        <main class="content">
            <div class="header-banner">
                <h1>Titan Component Creation Guide</h1>
            </div>
            <h1 id="titan-component-creation-guide">Titan Component Creation Guide</h1>

<h2 id="introduction">Introduction</h2>

<p>Titan components are system extensions that run in the background and can add functionality to the main application. Components can be enabled/disabled by users, integrate with the system menu, add custom views to the main interface, and extend the invisible UI and Klango mode.</p>

<h2 id="component-system-architecture">Component System Architecture</h2>

<h3 id="component-location">Component Location</h3>

<p>All components are located in the <code>data/components/</code> directory. Each component is a separate directory containing:
- <code>init.py</code> - main file with component code (NOT <code>__init__.py</code>!)
- <code>__component__.TCE</code> - component configuration file (INI format)</p>

<h3 id="component-lifecycle">Component Lifecycle</h3>

<ol>
<li><strong>Loading</strong> - components are loaded at Titan startup</li>
<li><strong>Initialization</strong> - <code>initialize(app)</code> method is called</li>
<li><strong>Operation</strong> - component runs in the background</li>
<li><strong>Shutdown</strong> - <code>shutdown()</code> method is called</li>
</ol>

<h2 id="configuration-file-structure">Configuration File Structure</h2>

<h3 id="__component__tce"><strong>component</strong>.TCE</h3>

<p>INI file with <code>[component]</code> section:</p>

<pre><code>[component]
name = Component Name
status = 1

</code></pre>

<p><strong>Parameters:</strong>
- <code>name</code> - name displayed in component manager
- <strong><code>status = 1</code> means DISABLED, <code>status = 0</code> means ENABLED</strong> (inverted!)
- <strong>IMPORTANT</strong>: File name is <code>__component__.TCE</code> (uppercase .TCE)
- <strong>IMPORTANT</strong>: Main file is <code>init.py</code> (lowercase, NOT <code>__init__.py</code>)
- <strong>IMPORTANT</strong>: Add blank line at end of file</p>

<h2 id="component-interface">Component Interface</h2>

<h3 id="required-functions">Required Functions</h3>

<h4 id="initializeappnone">initialize(app=None)</h4>

<p><strong>Required function</strong> called at Titan startup:
- <code>app</code> - wxPython main application instance (may be None)
- Use for initializing resources, starting threads</p>

<h3 id="optional-functions">Optional Functions</h3>

<h4 id="shutdown">shutdown()</h4>

<p>Called at Titan shutdown:
- Stop threads, free resources
- Save component state if needed</p>

<h4 id="add_menucomponent_manager">add<em>menu(component</em>manager)</h4>

<p>Adds items to component menu:
- <code>component_manager.register_menu_function(name, function)</code>
- Menu available in invisible UI and GUI menu</p>

<h4 id="add_settings_categorycomponent_manager">add<em>settings</em>category(component_manager)</h4>

<p><strong>Recommended</strong>: Registers settings category in modular settings system:</p>

<pre><code>def add_settings_category(component_manager):
    def build_panel(parent):
        panel = wx.Panel(parent)
        # ... add controls ...
        return panel

    component_manager.register_settings_category(
        "My Component",
        build_panel,
        save_callback,
        load_callback
    )
</code></pre>

<h2 id="hooks-system">Hooks System</h2>

<h3 id="gui-hooks-get_gui_hooks">GUI Hooks (get<em>gui</em>hooks)</h3>

<p>Component can register hooks to main GUI:</p>

<pre><code>def get_gui_hooks():
    """Return GUI hooks dict (optional)

    Available hooks:
        'on_gui_init': called with gui_app (TitanApp wx.Frame) when GUI is initialized
    """
    return {
        'on_gui_init': on_gui_init
    }

def on_gui_init(gui_app):
    """Hook called when GUI is initialized"""
    # Here you can register a view in the main panel
    pass
</code></pre>

<h3 id="invisible-ui-hooks-get_iui_hooks">Invisible UI Hooks (get<em>iui</em>hooks)</h3>

<p>Component can add custom categories to invisible UI:</p>

<pre><code>def get_iui_hooks():
    """Return Invisible UI hooks dict (optional)

    Available hooks:
        'on_iui_init': called with iui (InvisibleUI) after build_structure()
    """
    return {
        'on_iui_init': on_iui_init
    }

def on_iui_init(iui):
    """Hook called when Invisible UI is initialized"""
    iui.categories.append({
        "name": "My Component",
        "sound": "core/focus.ogg",
        "elements": ["Action 1", "Action 2"],
        "action": lambda name: handle_action(name)
    })
</code></pre>

<h3 id="klango-mode-hooks-get_klango_hooks">Klango Mode Hooks (get<em>klango</em>hooks)</h3>

<p>Component can integrate with Klango mode:</p>

<pre><code>def get_klango_hooks():
    """Return Klango mode hooks dict (optional)

    Available hooks:
        'on_klango_init': called with klango_mode (KlangoMode) when Klango mode starts
    """
    return {
        'on_klango_init': on_klango_init
    }
</code></pre>

<h2 id="component-view-registration-api">Component View Registration API</h2>

<p><strong>NEW!</strong> Components can add custom tabs/views to the main GUI left panel. Registered views appear in Ctrl+Tab cycle alongside built-in views (Application List, Game List, Titan IM).</p>

<h3 id="register_view-parameters">register_view() Parameters</h3>

<table>
<thead>
<tr>
  <th>Parameter</th>
  <th>Type</th>
  <th>Required</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>view_id</code></td>
  <td>str</td>
  <td>Yes</td>
  <td>Unique identifier, e.g. <code>'my_notes'</code></td>
</tr>
<tr>
  <td><code>label</code></td>
  <td>str</td>
  <td>Yes</td>
  <td>Header text shown above control, e.g. <code>'My Notes:'</code></td>
</tr>
<tr>
  <td><code>control</code></td>
  <td>wx.Window</td>
  <td>Yes</td>
  <td>Any wx control (ListBox, TreeCtrl, etc.), parent: <code>gui_app.main_panel</code></td>
</tr>
<tr>
  <td><code>on_show</code></td>
  <td>callable</td>
  <td>No</td>
  <td>Called every time view becomes visible (refresh data)</td>
</tr>
<tr>
  <td><code>on_activate</code></td>
  <td>callable</td>
  <td>No</td>
  <td>Called when user presses Enter on control</td>
</tr>
<tr>
  <td><code>position</code></td>
  <td>str/int</td>
  <td>No</td>
  <td>Position in cycle: <code>'after_apps'</code>, <code>'after_games'</code>, <code>'after_network'</code> (default), or integer index</td>
</tr>
</tbody>
</table>

<h3 id="how-it-works">How it works</h3>

<ul>
<li>Registered control is added to left panel sizer (hidden by default)</li>
<li>User presses Ctrl+Tab to cycle views: Apps → Games → [your view] → Titan IM → ...</li>
<li>Tab/Shift+Tab navigates between view control and status bar</li>
<li>Enter on view control calls <code>on_activate</code> (if provided)</li>
<li>TTS announces view label and position, e.g. "My Notes, 3 of 4"</li>
</ul>

<h2 id="complete-examples">Complete Examples</h2>

<h3 id="example-1-simple-list-view-bookmarks-manager">Example 1: Simple List View (Bookmarks Manager)</h3>

<p>Component adding a "Bookmarks" tab to left panel with saved bookmarks list.</p>

<p><strong>File: <code>data/components/bookmarks/init.py</code></strong></p>

<pre><code># -*- coding: utf-8 -*-
"""Bookmarks component - adds bookmarks list to main panel."""

import os
import sys
import wx
import json

COMPONENT_DIR = os.path.dirname(__file__)
TCE_ROOT = os.path.abspath(os.path.join(COMPONENT_DIR, '..', '..', '..'))
if TCE_ROOT not in sys.path:
    sys.path.insert(0, TCE_ROOT)

try:
    from src.titan_core.sound import play_sound
except ImportError:
    def play_sound(name): pass

try:
    from src.settings.settings import get_setting
except ImportError:
    def get_setting(key, default='', section='general'): return default

def _(text):
    return text

# --- Bookmark Data ---
BOOKMARKS_FILE = os.path.join(COMPONENT_DIR, 'bookmarks.json')
_bookmarks = []
_listbox = None


def load_bookmarks():
    """Load bookmarks from JSON file."""
    global _bookmarks
    try:
        if os.path.exists(BOOKMARKS_FILE):
            with open(BOOKMARKS_FILE, 'r', encoding='utf-8') as f:
                _bookmarks = json.load(f)
        else:
            _bookmarks = [
                {"name": "Google", "url": "https://google.com"},
                {"name": "YouTube", "url": "https://youtube.com"},
            ]
            save_bookmarks()
    except Exception as e:
        print(f"[bookmarks] Error loading bookmarks: {e}")
        _bookmarks = []


def save_bookmarks():
    """Save bookmarks to JSON file."""
    try:
        with open(BOOKMARKS_FILE, 'w', encoding='utf-8') as f:
            json.dump(_bookmarks, f, indent=2, ensure_ascii=False)
    except Exception as e:
        print(f"[bookmarks] Error saving bookmarks: {e}")


def refresh_list():
    """Refresh listbox with current bookmarks (called by on_show)."""
    if _listbox is None:
        return
    _listbox.Clear()
    for bm in _bookmarks:
        _listbox.Append(bm['name'])
    if _listbox.GetCount() &gt; 0:
        _listbox.SetSelection(0)


def on_bookmark_activate(event):
    """Open selected bookmark in browser (called by Enter key)."""
    if _listbox is None:
        return
    sel = _listbox.GetSelection()
    if sel == wx.NOT_FOUND or sel &gt;= len(_bookmarks):
        return
    url = _bookmarks[sel]['url']
    play_sound('ui/dialog.ogg')
    import webbrowser
    webbrowser.open(url)


def on_gui_init(gui_app):
    """Register bookmarks view in main left panel."""
    global _listbox
    _listbox = wx.ListBox(gui_app.main_panel)

    gui_app.register_view(
        view_id='bookmarks',
        label="Bookmarks:",
        control=_listbox,
        on_show=refresh_list,
        on_activate=on_bookmark_activate,
        position='after_network'
    )
    print("[bookmarks] View registered in main panel")


# --- Component Interface ---

def get_gui_hooks():
    return {'on_gui_init': on_gui_init}


def add_menu(component_manager):
    def add_bookmark(event):
        dlg = wx.TextEntryDialog(None, "Enter bookmark name:", "Add Bookmark")
        if dlg.ShowModal() == wx.ID_OK:
            name = dlg.GetValue().strip()
            if name:
                url_dlg = wx.TextEntryDialog(None, "Enter URL:", "Add Bookmark", "https://")
                if url_dlg.ShowModal() == wx.ID_OK:
                    url = url_dlg.GetValue().strip()
                    if url:
                        _bookmarks.append({"name": name, "url": url})
                        save_bookmarks()
                        refresh_list()
                        play_sound('ui/dialog.ogg')
                url_dlg.Destroy()
        dlg.Destroy()

    component_manager.register_menu_function("Add Bookmark...", add_bookmark)


def initialize(app=None):
    load_bookmarks()
    print("[bookmarks] Component initialized")


def shutdown():
    save_bookmarks()
    print("[bookmarks] Component shutdown")
</code></pre>

<p><strong>File: <code>data/components/bookmarks/__component__.TCE</code></strong></p>

<pre><code>[component]
name = Bookmarks
status = 0

</code></pre>

<h3 id="example-2-treectrl-view-file-browser">Example 2: TreeCtrl View (File Browser)</h3>

<p>Component adding a tree view showing files from a directory.</p>

<p><strong>File: <code>data/components/filebrowser/init.py</code></strong></p>

<pre><code># -*- coding: utf-8 -*-
"""File Browser component - adds file tree to main panel."""

import os
import sys
import wx

COMPONENT_DIR = os.path.dirname(__file__)
TCE_ROOT = os.path.abspath(os.path.join(COMPONENT_DIR, '..', '..', '..'))
if TCE_ROOT not in sys.path:
    sys.path.insert(0, TCE_ROOT)

try:
    from src.titan_core.sound import play_sound
except ImportError:
    def play_sound(name): pass

def _(text):
    return text

_tree = None
_browse_path = os.path.expanduser("~\\Documents")


def populate_tree():
    """Populate tree with files from browse_path (called by on_show)."""
    if _tree is None:
        return

    _tree.DeleteAllItems()
    root = _tree.AddRoot(_browse_path)

    try:
        for item_name in sorted(os.listdir(_browse_path)):
            full_path = os.path.join(_browse_path, item_name)
            if os.path.isdir(full_path):
                _tree.AppendItem(root, f"[DIR] {item_name}")
            else:
                _tree.AppendItem(root, item_name)
    except PermissionError:
        _tree.AppendItem(root, "Access denied")
    except Exception as e:
        _tree.AppendItem(root, f"Error: {e}")

    _tree.Expand(root)

    # Select first child
    child, cookie = _tree.GetFirstChild(root)
    if child.IsOk():
        _tree.SelectItem(child)


def on_file_activate(event):
    """Open selected file (called by Enter key)."""
    if _tree is None:
        return
    item = _tree.GetSelection()
    if not item.IsOk():
        return
    text = _tree.GetItemText(item)
    if text.startswith("[DIR] "):
        # Enter directory
        global _browse_path
        dir_name = text[6:]  # Remove "[DIR] " prefix
        _browse_path = os.path.join(_browse_path, dir_name)
        populate_tree()
        play_sound('core/focus.ogg')
    elif text == "Access denied":
        return
    else:
        # Open file
        file_path = os.path.join(_browse_path, text)
        if os.path.exists(file_path):
            os.startfile(file_path)
            play_sound('ui/dialog.ogg')


def on_gui_init(gui_app):
    """Register file browser view."""
    global _tree
    _tree = wx.TreeCtrl(
        gui_app.main_panel,
        style=wx.TR_DEFAULT_STYLE | wx.TR_HIDE_ROOT | wx.TR_SINGLE
    )

    gui_app.register_view(
        view_id='filebrowser',
        label="File Browser:",
        control=_tree,
        on_show=populate_tree,
        on_activate=on_file_activate,
        position='after_games'  # Between Games and Titan IM
    )
    print("[filebrowser] View registered in main panel")


# --- Component Interface ---

def get_gui_hooks():
    return {'on_gui_init': on_gui_init}


def initialize(app=None):
    print("[filebrowser] Component initialized")


def shutdown():
    print("[filebrowser] Component shutdown")
</code></pre>

<p><strong>File: <code>data/components/filebrowser/__component__.TCE</code></strong></p>

<pre><code>[component]
name = File Browser
status = 0

</code></pre>

<h2 id="component-types">Component Types</h2>

<ul>
<li><strong>Service</strong>: Background services (e.g., screen reader integration, system monitoring)</li>
<li><strong>Integration</strong>: Third-party service integrations (e.g., dictionary, article viewer)</li>
<li><strong>Feature</strong>: Additional features (e.g., terminal, tips system, launchers)</li>
<li><strong>View</strong>: Components that add a tab/view to main left panel (use <code>register_view()</code>)</li>
</ul>

<h2 id="key-guidelines">Key Guidelines</h2>

<ol>
<li><strong>Always use daemon threads</strong> - <code>threading.Thread(daemon=True)</code></li>
<li><strong>Implement shutdown()</strong> - stop all threads</li>
<li><strong>Use wx.CallAfter</strong> for GUI operations from threads</li>
<li><strong>Test enable/disable</strong> functionality</li>
<li><strong>Add error handling</strong> - components shouldn't crash Titan</li>
<li><strong>Conserve resources</strong> - don't run heavy operations too frequently</li>
<li><strong>Use get<em>gui</em>hooks()</strong> for views instead of direct GUI modification</li>
<li><strong>Refresh data in on_show</strong> when view becomes visible (Ctrl+Tab)</li>
<li><strong>Add context menus</strong> for better UX (right-click on ListBox/TreeCtrl)</li>
</ol>

<h2 id="testing-components">Testing Components</h2>

<ol>
<li>Place component in <code>data/components/component_name/</code></li>
<li>Ensure file is <code>init.py</code> not <code>__init__.py</code></li>
<li>Check <code>__component__.TCE</code> format (INI, uppercase .TCE)</li>
<li>Start Titan</li>
<li>Check component manager if component is loaded</li>
<li>Test functionality through component menu</li>
<li>If component registers view, test Ctrl+Tab cycle</li>
</ol>

<p>Components enable extending Titan functionality in a modular and safe way. With the simple API, you can easily add new capabilities without modifying the main application code.</p>

            <a href="#" class="back-to-top" title="Powrót na górę">↑</a>
        </main>
    </div>
</body>
</html>
