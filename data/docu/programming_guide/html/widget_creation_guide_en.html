<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titan Widget Creation Guide - TCE Launcher Programming Guide</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --bg-color: #ffffff;
            --text-color: #1f2937;
            --code-bg: #f3f4f6;
            --sidebar-bg: #f9fafb;
            --border-color: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        .sidebar nav ul {
            list-style: none;
        }

        .sidebar nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar nav a {
            color: var(--text-color);
            text-decoration: none;
            display: block;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .sidebar nav a:hover {
            background-color: var(--code-bg);
        }

        .sidebar nav a.active {
            background-color: var(--primary-color);
            color: white;
        }

        .content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem 3rem;
            max-width: 1200px;
        }

        .content h1 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-color);
            font-size: 2.5rem;
        }

        .content h2 {
            color: var(--secondary-color);
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .content h3 {
            color: var(--text-color);
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
        }

        .content h4 {
            color: var(--text-color);
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .content p {
            margin-bottom: 1rem;
        }

        .content ul, .content ol {
            margin-bottom: 1rem;
            margin-left: 2rem;
        }

        .content li {
            margin-bottom: 0.5rem;
        }

        .content code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }

        .content pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }

        .content pre code {
            background: none;
            padding: 0;
            font-size: 0.875rem;
        }

        .doc-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .doc-table th {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }

        .doc-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .doc-table tr:hover {
            background: var(--code-bg);
        }

        .content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .content a:hover {
            text-decoration: underline;
        }

        .content blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #6b7280;
            font-style: italic;
        }

        .header-banner {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 1rem 3rem;
            margin: -2rem -3rem 2rem -3rem;
        }

        .header-banner h1 {
            color: white;
            border: none;
            padding: 0;
            margin: 0;
        }

        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .back-to-top:hover {
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .content {
                margin-left: 0;
                padding: 1.5rem;
            }

            .header-banner {
                margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h2>TCE Launcher<br>Programming Guide</h2>
            <nav>
                <ul>
                    <li style="border-top: 1px solid var(--border-color); padding-top: 0.5rem; margin-top: 0.5rem;"><a href="index_pl.html">Polski version</a></li>
<li><a href="component_creation_guide_en.html">Creating Components</a></li>
<li><a href="widget_creation_guide_en.html" class="active">Creating Widgets</a></li>
<li><a href="statusbar_applet_guide_en.html">Statusbar Applets</a></li>
<li><a href="titanim_module_guide_en.html">Titan IM Modules</a></li>
<li><a href="app_creation_guide_en.html">Creating Applications</a></li>
<li><a href="game_creation_guide_en.html">Creating Games</a></li>
                </ul>
            </nav>
        </aside>

        <main class="content">
            <div class="header-banner">
                <h1>Titan Widget Creation Guide</h1>
            </div>
            <h1 id="titan-widget-creation-guide">Titan Widget Creation Guide</h1>

<h2 id="introduction">Introduction</h2>

<p>Titan widgets are interactive components available in the invisible interface that allow programmers to create custom functionality. The system supports two types of widgets: <strong>button</strong> (simple action) and <strong>grid</strong> (navigable interface).</p>

<h2 id="widget-system-architecture">Widget System Architecture</h2>

<h3 id="widget-location">Widget Location</h3>

<p>All widgets are located in the <code>data/applets/</code> directory. Each widget is a separate directory containing:
- <code>main.py</code> or <code>init.py</code> - main file with widget code
- <code>applet.json</code> (optional) - widget metadata in the new system</p>

<h3 id="basewidget-class">BaseWidget Class</h3>

<p>Titan provides a base class <code>BaseWidget</code> in <code>invisibleui.py</code>:</p>

<pre><code>class BaseWidget:
    def __init__(self, speak_func):
        self.speak = speak_func
        self.view = None

    def speak_with_position(self, text, position=0.0, pitch_offset=0):
        """Speaks text with stereo positioning"""
        self.speak(text, position=position, pitch_offset=pitch_offset)

    def set_border(self):
        """Sets widget border (for GUI)"""
        pass

    def get_current_element(self):
        """Returns description of current element - REQUIRED"""
        raise NotImplementedError

    def navigate(self, direction):
        """Navigation within widget - REQUIRED for 'grid' type"""
        raise NotImplementedError

    def activate_current_element(self):
        """Activates current element - REQUIRED"""
        raise NotImplementedError
</code></pre>

<h2 id="widget-types">Widget Types</h2>

<h3 id="1-button-type-widget">1. "button" Type Widget</h3>

<p>Simple single-use widget that performs an action when activated.</p>

<p><strong>Implementation example:</strong></p>

<pre><code>class WidgetButton:
    def __init__(self, speak_func, view=None):
        self.speak = speak_func
        self.view = view

    def activate_current_element(self):
        """Activates the widget"""
        self.speak("Example button activated!")
        # Perform action

    def get_current_element(self):
        """Returns button name"""
        return "Example Button"

def get_widget_info():
    return {
        "name": "My Button",
        "type": "button",
    }

def get_widget_instance(speak_func, view=None):
    return WidgetButton(speak_func, view)
</code></pre>

<h3 id="2-grid-type-widget">2. "grid" Type Widget</h3>

<p>Interactive widget allowing navigation in multiple directions.</p>

<p><strong>Implementation example:</strong></p>

<pre><code>from invisibleui import BaseWidget

class WidgetGrid(BaseWidget):
    def __init__(self, speak_func, view=None):
        super().__init__(speak_func)
        self.view = view
        self.grid = [
            ["Top-Left", "Top-Right"],
            ["Bottom-Left", "Bottom-Right"]
        ]
        self.current_pos = [0, 0]  # [row, column]

    def navigate(self, direction):
        """Grid navigation"""
        rows = len(self.grid)
        cols = len(self.grid[0]) if self.grid else 1
        old_pos = self.current_pos[:]

        if direction == 'up' and self.current_pos[0] &gt; 0:
            self.current_pos[0] -= 1
        elif direction == 'down' and self.current_pos[0] &lt; rows - 1:
            self.current_pos[0] += 1
        elif direction == 'left' and self.current_pos[1] &gt; 0:
            self.current_pos[1] -= 1
        elif direction == 'right' and self.current_pos[1] &lt; cols - 1:
            self.current_pos[1] += 1
        else:
            return False, self.current_pos[1], cols  # Edge reached

        # Return success and position for stereo positioning
        return True, self.current_pos[1], cols

    def activate_current_element(self):
        """Activates current element"""
        element = self.get_current_element()

        # Use stereo positioning
        cols = len(self.grid[0]) if self.grid else 1
        position = (self.current_pos[1] / (cols - 1) * 2.0) - 1.0 if cols &gt; 1 else 0.0

        self.speak_with_position(f"Activated: {element}", position=position)

    def get_current_element(self):
        """Returns current element"""
        return self.grid[self.current_pos[0]][self.current_pos[1]]

def get_widget_info():
    return {
        "name": "Example Grid",
        "type": "grid",
    }

def get_widget_instance(speak_func, view=None):
    return WidgetGrid(speak_func, view)
</code></pre>

<h2 id="widget-metadata-appletjson">Widget Metadata (applet.json)</h2>

<p>The new system allows defining metadata in <code>applet.json</code>:</p>

<pre><code>{
    "name_pl": "Mój widget",
    "name_en": "My Widget", 
    "description_pl": "Opis widgetu po polsku",
    "description_en": "Widget description in English",
    "version": "1.0.0",
    "author": "Your Name",
    "type": "grid"
}
</code></pre>

<h2 id="stereo-positioning-features">Stereo Positioning Features</h2>

<h3 id="speak_with_position">speak<em>with</em>position()</h3>

<p>By inheriting from <code>BaseWidget</code>, you get access to the <code>speak_with_position()</code> method:</p>

<pre><code>self.speak_with_position(text, position=0.0, pitch_offset=0)
</code></pre>

<p><strong>Parameters:</strong>
- <code>text</code> - text to speak
- <code>position</code> - stereo position: -1.0 (left) to 1.0 (right), 0.0 = center<br />
- <code>pitch_offset</code> - pitch change: -10 to +10</p>

<h3 id="automatic-positioning">Automatic Positioning</h3>

<p>The system automatically positions speech based on values returned from <code>navigate()</code>:
- Left/right navigation uses stereo positioning
- Up/down navigation uses pitch change</p>

<h2 id="required-methods">Required Methods</h2>

<h3 id="get_widget_info">get<em>widget</em>info()</h3>

<p><strong>Required function</strong> at module level:</p>

<pre><code>def get_widget_info():
    return {
        "name": "Widget Name",
        "type": "button" # or "grid"
    }
</code></pre>

<h3 id="get_widget_instance">get<em>widget</em>instance()</h3>

<p><strong>Required function</strong> at module level:</p>

<pre><code>def get_widget_instance(speak_func, view=None):
    return MyWidget(speak_func, view)
</code></pre>

<h3 id="get_current_element">get<em>current</em>element()</h3>

<p><strong>Required method</strong> of widget class - returns description of current element.</p>

<h3 id="activate_current_element">activate<em>current</em>element()</h3>

<p><strong>Required method</strong> of widget class - performs activation action.</p>

<h3 id="navigate-only-for-grid-type">navigate() (only for "grid" type)</h3>

<p><strong>Required method</strong> for "grid" type widgets:</p>

<pre><code>def navigate(self, direction):
    # direction: 'up', 'down', 'left', 'right'
    # Return: (success, horizontal_index, total_horizontal_items)
    return True, current_column, total_columns
</code></pre>

<h2 id="directory-structure">Directory Structure</h2>

<h3 id="legacy-system-initpy">Legacy system (init.py)</h3>

<pre><code>data/applets/my_widget/
├── init.py              # Main widget file
</code></pre>

<h3 id="new-system-mainpy-appletjson">New system (main.py + applet.json)</h3>

<pre><code>data/applets/my_widget/
├── main.py              # Main widget file
├── applet.json          # Widget metadata
├── babel.cfg            # Translation config (optional)
└── languages/           # Translations (optional)
    ├── messages.pot
    ├── pl/
    └── en/
</code></pre>

<h2 id="internationalization">Internationalization</h2>

<h3 id="adding-translations">Adding Translations</h3>

<ol>
<li>Create <code>babel.cfg</code>:</li>
</ol>

<pre><code>[python: **.py]
</code></pre>

<ol start="2">
<li>Use <code>_()</code> function in code:</li>
</ol>

<pre><code>import gettext
import os

# Setup translations
domain = 'my_widget'
localedir = os.path.join(os.path.dirname(__file__), 'languages')
try:
    translation = gettext.translation(domain, localedir, fallback=True)
    _ = translation.gettext
except Exception:
    _ = lambda x: x

# In code
self.speak(_("Text to translate"))
</code></pre>

<ol start="3">
<li>Extract texts for translation:</li>
</ol>

<pre><code>pybabel extract -o messages.pot --input-dirs=.
</code></pre>

<ol start="4">
<li>Create translation files:</li>
</ol>

<pre><code>pybabel init -l pl -d languages -i messages.pot
pybabel init -l en -d languages -i messages.pot
</code></pre>

<ol start="5">
<li>Compile translations:</li>
</ol>

<pre><code>pybabel compile -d languages
</code></pre>

<h2 id="practical-examples">Practical Examples</h2>

<h3 id="example-1-clock-widget">Example 1: Clock Widget</h3>

<pre><code>import datetime
from invisibleui import BaseWidget

class ClockWidget(BaseWidget):
    def __init__(self, speak_func, view=None):
        super().__init__(speak_func)
        self.view = view

    def get_current_element(self):
        now = datetime.datetime.now()
        return f"Current time: {now.strftime('%H:%M:%S')}"

    def activate_current_element(self):
        self.speak(self.get_current_element())

def get_widget_info():
    return {"name": "Clock", "type": "button"}

def get_widget_instance(speak_func, view=None):
    return ClockWidget(speak_func, view)
</code></pre>

<h3 id="example-2-simple-calculator-widget">Example 2: Simple Calculator Widget</h3>

<pre><code>from invisibleui import BaseWidget

class SimpleCalculator(BaseWidget):
    def __init__(self, speak_func, view=None):
        super().__init__(speak_func)
        self.view = view
        self.operations = [
            ["1 + 1 = 2", "2 + 2 = 4", "3 + 3 = 6"],
            ["5 * 5 = 25", "10 / 2 = 5", "2^3 = 8"]
        ]
        self.current_pos = [0, 0]

    def navigate(self, direction):
        rows = len(self.operations)
        cols = len(self.operations[0])

        if direction == 'up' and self.current_pos[0] &gt; 0:
            self.current_pos[0] -= 1
        elif direction == 'down' and self.current_pos[0] &lt; rows - 1:
            self.current_pos[0] += 1
        elif direction == 'left' and self.current_pos[1] &gt; 0:
            self.current_pos[1] -= 1
        elif direction == 'right' and self.current_pos[1] &lt; cols - 1:
            self.current_pos[1] += 1
        else:
            return False, self.current_pos[1], cols

        return True, self.current_pos[1], cols

    def get_current_element(self):
        return self.operations[self.current_pos[0]][self.current_pos[1]]

    def activate_current_element(self):
        element = self.get_current_element()
        self.speak(f"Selected example: {element}")

def get_widget_info():
    return {"name": "Simple Calculator", "type": "grid"}

def get_widget_instance(speak_func, view=None):
    return SimpleCalculator(speak_func, view)
</code></pre>

<h2 id="testing-widgets">Testing Widgets</h2>

<ol>
<li>Place widget in <code>data/applets/widget_name/</code> directory</li>
<li>Start Titan</li>
<li>Enter invisible interface (Ctrl+Shift+arrows)</li>
<li>Navigate to "Widgets" category</li>
<li>Select your widget and test functionality</li>
</ol>

<h2 id="important-guidelines">Important Guidelines</h2>

<ol>
<li><strong>DO NOT</strong> use <code>self.speak()</code> in the <code>navigate()</code> method - the system automatically handles speech with positioning</li>
<li>Use <code>speak_with_position()</code> in <code>activate_current_element()</code> for better experience</li>
<li>Always implement all required methods</li>
<li>Test navigation in all directions</li>
<li>Add error handling for invalid data</li>
<li>Use internationalization for better accessibility</li>
</ol>

<h2 id="available-tools">Available Tools</h2>

<ul>
<li><code>self.speak()</code> - basic TTS speech</li>
<li><code>self.speak_with_position()</code> - speech with stereo positioning</li>
<li><code>play_sound()</code> - play sounds (import from <code>sound</code>)</li>
<li>Settings system (import from <code>settings</code>)</li>
<li>Access to main application frame through <code>self.view</code></li>
</ul>

<p>Titan provides a rich API for creating custom, accessible widgets with full support for screen reader users.</p>

            <a href="#" class="back-to-top" title="Powrót na górę">↑</a>
        </main>
    </div>
</body>
</html>
