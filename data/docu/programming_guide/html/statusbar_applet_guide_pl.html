<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Przewodnik tworzenia apletów paska statusu Titan - TCE Launcher Programming Guide</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --bg-color: #ffffff;
            --text-color: #1f2937;
            --code-bg: #f3f4f6;
            --sidebar-bg: #f9fafb;
            --border-color: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        .sidebar nav ul {
            list-style: none;
        }

        .sidebar nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar nav a {
            color: var(--text-color);
            text-decoration: none;
            display: block;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .sidebar nav a:hover {
            background-color: var(--code-bg);
        }

        .sidebar nav a.active {
            background-color: var(--primary-color);
            color: white;
        }

        .content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem 3rem;
            max-width: 1200px;
        }

        .content h1 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-color);
            font-size: 2.5rem;
        }

        .content h2 {
            color: var(--secondary-color);
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .content h3 {
            color: var(--text-color);
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
        }

        .content h4 {
            color: var(--text-color);
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .content p {
            margin-bottom: 1rem;
        }

        .content ul, .content ol {
            margin-bottom: 1rem;
            margin-left: 2rem;
        }

        .content li {
            margin-bottom: 0.5rem;
        }

        .content code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }

        .content pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }

        .content pre code {
            background: none;
            padding: 0;
            font-size: 0.875rem;
        }

        .doc-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .doc-table th {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }

        .doc-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .doc-table tr:hover {
            background: var(--code-bg);
        }

        .content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .content a:hover {
            text-decoration: underline;
        }

        .content blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #6b7280;
            font-style: italic;
        }

        .header-banner {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 1rem 3rem;
            margin: -2rem -3rem 2rem -3rem;
        }

        .header-banner h1 {
            color: white;
            border: none;
            padding: 0;
            margin: 0;
        }

        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .back-to-top:hover {
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .content {
                margin-left: 0;
                padding: 1.5rem;
            }

            .header-banner {
                margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h2>TCE Launcher<br>Programming Guide</h2>
            <nav>
                <ul>
                    <li style="border-top: 1px solid var(--border-color); padding-top: 0.5rem; margin-top: 0.5rem;"><a href="index_en.html">English version</a></li>
<li><a href="component_creation_guide_pl.html">Tworzenie komponentów</a></li>
<li><a href="widget_creation_guide_pl.html">Tworzenie widgetów</a></li>
<li><a href="statusbar_applet_guide_pl.html" class="active">Aplety paska statusu</a></li>
<li><a href="titanim_module_guide_pl.html">Moduły Titan IM</a></li>
<li><a href="app_creation_guide_pl.html">Tworzenie aplikacji</a></li>
<li><a href="game_creation_guide_pl.html">Tworzenie gier</a></li>
                </ul>
            </nav>
        </aside>

        <main class="content">
            <div class="header-banner">
                <h1>Przewodnik tworzenia apletów paska statusu Titan</h1>
            </div>
            <h1 id="przewodnik-tworzenia-apletow-paska-statusu-titan">Przewodnik tworzenia apletów paska statusu Titan</h1>

<h2 id="wprowadzenie">Wprowadzenie</h2>

<p>Aplety paska statusu to małe wtyczki znajdujące się w katalogu <code>data/statusbar_applets/</code>, które wyświetlają dynamiczne informacje w pasku statusu we wszystkich trybach interfejsu (GUI, IUI, Klango). Są ładowane przez <code>StatusbarAppletManager</code> (<code>src/titan_core/statusbar_applet_manager.py</code>).</p>

<p>Przykłady: informacje systemowe (CPU/RAM/Dysk), zegar, status sieci.</p>

<h2 id="architektura-apletow-paska-statusu">Architektura apletów paska statusu</h2>

<h3 id="lokalizacja-apletow">Lokalizacja apletów</h3>

<p>Wszystkie aplety znajdują się w katalogu <code>data/statusbar_applets/</code>. Każdy aplet to osobny katalog zawierający:
- <code>main.py</code> - główny plik z kodem apletu
- <code>applet.json</code> - plik metadanych apletu</p>

<p><strong>Oba pliki są wymagane</strong> aby aplet został załadowany.</p>

<h3 id="cykl-zycia-apletu">Cykl życia apletu</h3>

<ol>
<li><strong>Ładowanie</strong> - aplety są ładowane przy starcie Titan</li>
<li><strong>Odświeżanie</strong> - funkcja <code>get_statusbar_item_text()</code> jest wywoływana co N sekund (zgodnie z <code>update_interval</code>)</li>
<li><strong>Aktywacja</strong> - opcjonalna funkcja <code>on_statusbar_item_activate()</code> wywoływana po dwukliknięciu/aktywacji</li>
</ol>

<h2 id="struktura-pliku-metadanych">Struktura pliku metadanych</h2>

<h3 id="appletjson">applet.json</h3>

<pre><code>{
    "name": "Nazwa po angielsku",
    "name_pl": "Nazwa po polsku",
    "name_en": "Nazwa po angielsku",
    "description": "Opis po angielsku",
    "description_pl": "Opis po polsku",
    "description_en": "Opis po angielsku",
    "version": "1.0.0",
    "author": "TCE Launcher",
    "update_interval": 5
}
</code></pre>

<p><strong>Parametry:</strong>
- <code>name</code>, <code>name_pl</code>, <code>name_en</code> - nazwa apletu w różnych językach
- <code>description</code>, <code>description_pl</code>, <code>description_en</code> - opis apletu
- <code>version</code> - wersja apletu (semver)
- <code>author</code> - autor apletu
- <code>update_interval</code> - interwał odświeżania w sekundach</p>

<h2 id="implementacja-apletu">Implementacja apletu</h2>

<h3 id="podstawowa-struktura-mainpy">Podstawowa struktura main.py</h3>

<pre><code>"""
Nazwa apletu - Statusbar Applet

Opis apletu
"""

import os
import sys

# Dodaj katalog główny TCE do ścieżki
APPLET_DIR = os.path.dirname(os.path.abspath(__file__))
TCE_ROOT = os.path.abspath(os.path.join(APPLET_DIR, '..', '..', '..'))
if TCE_ROOT not in sys.path:
    sys.path.insert(0, TCE_ROOT)

from src.titan_core.translation import set_language
from src.settings.settings import get_setting

# Inicjalizacja tłumaczeń
_ = set_language(get_setting('language', 'pl'))


def get_statusbar_item_info():
    """
    Zwróć metadane apletu.

    Returns:
        dict: Informacje o aplecie z polami 'name' i 'update_interval'
    """
    return {
        "name": _("Nazwa apletu"),
        "update_interval": 5  # Odświeżaj co 5 sekund
    }


def get_statusbar_item_text():
    """
    Zwróć tekst do wyświetlenia w pasku statusu.

    Ta funkcja jest wywoływana okresowo (co update_interval sekund).
    Trzymaj ją szybką — ma narzucony timeout 2 sekundy przez StatusbarAppletManager.

    Returns:
        str: Tekst do wyświetlenia w pasku statusu
    """
    try:
        # Dodaj logikę pobierania tekstu paska statusu tutaj
        value = "..."  # Zastąp rzeczywistymi danymi

        return _("Nazwa apletu: {value}").format(value=value)
    except Exception as e:
        print(f"Error getting applet_id information: {e}")
        return _("Nazwa apletu: Error")


def on_statusbar_item_activate(parent_frame=None):
    """
    Opcjonalnie: Obsłuż aktywację gdy użytkownik wybierze ten element paska statusu.

    Wywoływana gdy użytkownik dwukliknie lub aktywuje element paska statusu.

    Args:
        parent_frame: wx.Frame dla okien dialogowych GUI (None dla trybu konsoli/niewidzialnego)
    """
    try:
        if parent_frame:
            # Tryb GUI — pokaż szczegółowe okno dialogowe
            import wx

            # Zbuduj szczegółową wiadomość tutaj
            message = _("Szczegółowe informacje apletu:\n\n")
            message += "..."  # Dodaj szczegóły

            wx.MessageBox(
                message,
                _("Nazwa apletu"),
                wx.OK | wx.ICON_INFORMATION,
                parent_frame
            )
        else:
            # Tryb konsoli/niewidzialny — wypisz informacje
            print(_("Nazwa apletu - widok szczegółowy niedostępny w trybie konsoli"))

    except Exception as e:
        print(f"Error showing applet_id details: {e}")
        import traceback
        traceback.print_exc()
</code></pre>

<h2 id="wymagane-funkcje">Wymagane funkcje</h2>

<h3 id="get_statusbar_item_info">get<em>statusbar</em>item_info()</h3>

<p><strong>Wymagana funkcja</strong> zwracająca metadane apletu:</p>

<pre><code>def get_statusbar_item_info():
    return {
        "name": _("Nazwa apletu"),  # Nazwa wyświetlana
        "update_interval": 5  # Interwał odświeżania w sekundach
    }
</code></pre>

<h3 id="get_statusbar_item_text">get<em>statusbar</em>item_text()</h3>

<p><strong>Wymagana funkcja</strong> zwracająca tekst paska statusu:</p>

<pre><code>def get_statusbar_item_text():
    # MUSI zwrócić string
    # MUSI wykonać się w &lt; 2 sekundy (timeout)
    # NIGDY nie powinna rzucać wyjątku — zawsze zwracaj string
    return "Tekst paska statusu"
</code></pre>

<h2 id="opcjonalne-funkcje">Opcjonalne funkcje</h2>

<h3 id="on_statusbar_item_activateparent_framenone">on<em>statusbar</em>item<em>activate(parent</em>frame=None)</h3>

<p>Obsługuje aktywację elementu paska statusu:</p>

<pre><code>def on_statusbar_item_activate(parent_frame=None):
    if parent_frame:
        # Tryb GUI — pokaż wx.MessageBox lub własne okno
        import wx
        wx.MessageBox("Szczegóły", "Tytuł", wx.OK | wx.ICON_INFORMATION, parent_frame)
    else:
        # Tryb konsoli — wypisz informacje
        print("Szczegóły apletu")
</code></pre>

<h2 id="kluczowe-wskazowki-od-statusbarappletmanager">Kluczowe wskazówki od StatusbarAppletManager</h2>

<h3 id="zasady-wydajnosci">Zasady wydajności</h3>

<ol>
<li><strong>Trzymaj <code>get_statusbar_item_text()</code> szybką</strong> — poniżej 2 sekund</li>
<li><strong>Cachuj kosztowne dane</strong> — nie odczytuj plików przy każdym wywołaniu</li>
<li><strong>Obsługuj wyjątki gracefully</strong> — zawsze zwracaj string, nigdy nie rzucaj wyjątku</li>
<li><strong>Używaj <code>interval=0.1</code></strong> dla próbkowania CPU (nie blokującej <code>interval=1</code>)</li>
</ol>

<h3 id="system-cachowania">System cachowania</h3>

<ul>
<li>Tekst apletu jest cachowany z <strong>timeout 2 sekundy</strong></li>
<li>Jeśli timeout zostanie przekroczony, w pasku statusu pojawi się "Error: Timeout"</li>
<li><code>update_interval</code> z <code>applet.json</code> ustawia jak często cache jest odświeżany</li>
<li>Priorytet nazwy wyświetlanej: <code>get_statusbar_item_info()['name']</code> &gt; lokalizowana nazwa z <code>applet.json</code></li>
</ul>

<h3 id="wymagania-ładowania">Wymagania ładowania</h3>

<p>Aby aplet został załadowany:
- <strong>Oba pliki <code>applet.json</code> i <code>main.py</code> są wymagane</strong>
- Katalog musi być w <code>data/statusbar_applets/{applet_id}/</code>
- <code>get_statusbar_item_info()</code> i <code>get_statusbar_item_text()</code> muszą być zdefiniowane</p>

<h2 id="przykłady-apletow">Przykłady apletów</h2>

<h3 id="przykład-1-aplet-zegara">Przykład 1: Aplet zegara</h3>

<p>Pokazuje aktualny czas (GG:MM) w pasku statusu. Po aktywacji wyświetla pełną datę, czas i dzień tygodnia.</p>

<p><strong>Plik: <code>data/statusbar_applets/clock/applet.json</code></strong></p>

<pre><code>{
    "name": "Clock",
    "name_pl": "Zegar",
    "name_en": "Clock",
    "description": "Displays current time in the statusbar",
    "description_pl": "Wyświetla aktualny czas na pasku stanu",
    "description_en": "Displays current time in the statusbar",
    "version": "1.0.0",
    "author": "TCE Launcher",
    "update_interval": 30
}
</code></pre>

<p><strong>Plik: <code>data/statusbar_applets/clock/main.py</code></strong></p>

<pre><code>"""
Aplet zegara paska statusu

Wyświetla aktualny czas w pasku statusu.
Po aktywacji pokazuje pełną datę, czas i dzień tygodnia.
"""

import os
import sys
from datetime import datetime

# Dodaj katalog główny TCE do ścieżki
APPLET_DIR = os.path.dirname(os.path.abspath(__file__))
TCE_ROOT = os.path.abspath(os.path.join(APPLET_DIR, '..', '..', '..'))
if TCE_ROOT not in sys.path:
    sys.path.insert(0, TCE_ROOT)

from src.titan_core.translation import set_language
from src.settings.settings import get_setting

# Inicjalizacja tłumaczeń
_ = set_language(get_setting('language', 'pl'))


def get_statusbar_item_info():
    """
    Zwróć metadane apletu.

    Returns:
        dict: Informacje o aplecie z polami 'name' i 'update_interval'
    """
    return {
        "name": _("Zegar"),
        "update_interval": 30
    }


def get_statusbar_item_text():
    """
    Zwróć aktualny czas jako GG:MM dla paska statusu.

    Returns:
        str: Aktualny czas sformatowany jako GG:MM
    """
    try:
        now = datetime.now()
        time_str = now.strftime("%H:%M")
        return time_str
    except Exception as e:
        print(f"Error getting clock information: {e}")
        return _("Zegar: Błąd")


def on_statusbar_item_activate(parent_frame=None):
    """
    Pokaż pełną datę, czas i dzień tygodnia po aktywacji.

    Args:
        parent_frame: wx.Frame dla okien dialogowych GUI (None dla trybu konsoli/niewidzialnego)
    """
    try:
        now = datetime.now()

        days_pl = {
            0: "Poniedziałek", 1: "Wtorek", 2: "Środa",
            3: "Czwartek", 4: "Piątek", 5: "Sobota", 6: "Niedziela"
        }
        day_name = days_pl.get(now.weekday(), "Nieznany")

        full_date = now.strftime("%Y-%m-%d")
        full_time = now.strftime("%H:%M:%S")

        message = _("Data: {date}\nCzas: {time}\nDzień tygodnia: {day}").format(
            date=full_date,
            time=full_time,
            day=day_name
        )

        if parent_frame:
            import wx
            wx.MessageBox(
                message,
                _("Zegar"),
                wx.OK | wx.ICON_INFORMATION,
                parent_frame
            )
        else:
            print(message)

    except Exception as e:
        print(f"Error showing clock details: {e}")
        import traceback
        traceback.print_exc()
</code></pre>

<hr />

<h3 id="przykład-2-aplet-statusu-baterii">Przykład 2: Aplet statusu baterii</h3>

<p>Pokazuje procent baterii i status ładowania. Gracefully obsługuje komputery stacjonarne bez baterii.</p>

<p><strong>Plik: <code>data/statusbar_applets/battery/applet.json</code></strong></p>

<pre><code>{
    "name": "Battery",
    "name_pl": "Bateria",
    "name_en": "Battery",
    "description": "Displays battery percentage and charging status",
    "description_pl": "Wyświetla poziom baterii i stan ładowania",
    "description_en": "Displays battery percentage and charging status",
    "version": "1.0.0",
    "author": "TCE Launcher",
    "update_interval": 60
}
</code></pre>

<p><strong>Plik: <code>data/statusbar_applets/battery/main.py</code></strong></p>

<pre><code>"""
Aplet statusu baterii paska statusu

Wyświetla procent baterii i status ładowania w pasku statusu.
Po aktywacji pokazuje szczegółowe informacje o baterii włącznie z czasem pozostałym.
Gracefully obsługuje komputery stacjonarne bez baterii.
"""

import os
import sys

# Dodaj katalog główny TCE do ścieżki
APPLET_DIR = os.path.dirname(os.path.abspath(__file__))
TCE_ROOT = os.path.abspath(os.path.join(APPLET_DIR, '..', '..', '..'))
if TCE_ROOT not in sys.path:
    sys.path.insert(0, TCE_ROOT)

from src.titan_core.translation import set_language
from src.settings.settings import get_setting

# Inicjalizacja tłumaczeń
_ = set_language(get_setting('language', 'pl'))

try:
    import psutil
    HAS_PSUTIL = True
except ImportError:
    HAS_PSUTIL = False


def get_statusbar_item_info():
    """
    Zwróć metadane apletu.

    Returns:
        dict: Informacje o aplecie z polami 'name' i 'update_interval'
    """
    return {
        "name": _("Bateria"),
        "update_interval": 60
    }


def _get_battery():
    """
    Bezpiecznie pobierz informacje o baterii.

    Returns:
        psutil battery named tuple lub None jeśli niedostępne
    """
    if not HAS_PSUTIL:
        return None
    try:
        return psutil.sensors_battery()
    except Exception:
        return None


def get_statusbar_item_text():
    """
    Zwróć procent baterii i wskaźnik ładowania dla paska statusu.

    Returns:
        str: Tekst statusu baterii (np. "Bateria: 75% [Ładowanie]" lub "Brak baterii")
    """
    try:
        battery = _get_battery()
        if battery is None:
            return _("Bateria: N/D")

        percent = int(battery.percent)
        if battery.power_plugged:
            status = _("Ładowanie")
        else:
            status = _("Rozładowywanie")

        return _("Bateria: {percent}% [{status}]").format(
            percent=percent,
            status=status
        )
    except Exception as e:
        print(f"Error getting battery information: {e}")
        return _("Bateria: Błąd")


def on_statusbar_item_activate(parent_frame=None):
    """
    Pokaż szczegółowe informacje o baterii po aktywacji.

    Args:
        parent_frame: wx.Frame dla okien dialogowych GUI (None dla trybu konsoli/niewidzialnego)
    """
    try:
        battery = _get_battery()

        if battery is None:
            message = _("Nie wykryto baterii. To może być komputer stacjonarny lub psutil nie jest zainstalowane.")
        else:
            percent = int(battery.percent)
            plugged = _("Tak") if battery.power_plugged else _("Nie")

            if battery.secsleft == psutil.POWER_TIME_UNLIMITED:
                time_remaining = _("Nieograniczony (podłączony)")
            elif battery.secsleft == psutil.POWER_TIME_UNKNOWN:
                time_remaining = _("Nieznany")
            else:
                hours = battery.secsleft // 3600
                minutes = (battery.secsleft % 3600) // 60
                time_remaining = _("{hours}g {minutes}m").format(
                    hours=hours,
                    minutes=minutes
                )

            message = _("Poziom baterii: {percent}%\n"
                        "Podłączona: {plugged}\n"
                        "Czas pozostały: {time_remaining}").format(
                percent=percent,
                plugged=plugged,
                time_remaining=time_remaining
            )

        if parent_frame:
            import wx
            wx.MessageBox(
                message,
                _("Status baterii"),
                wx.OK | wx.ICON_INFORMATION,
                parent_frame
            )
        else:
            print(message)

    except Exception as e:
        print(f"Error showing battery details: {e}")
        import traceback
        traceback.print_exc()
</code></pre>

<hr />

<h3 id="przykład-3-aplet-statusu-sieci">Przykład 3: Aplet statusu sieci</h3>

<p>Pokazuje aktualny typ połączenia sieciowego i adres IP. Po aktywacji wyświetla wszystkie interfejsy sieciowe.</p>

<p><strong>Plik: <code>data/statusbar_applets/network_status/applet.json</code></strong></p>

<pre><code>{
    "name": "Network Status",
    "name_pl": "Status sieci",
    "name_en": "Network Status",
    "description": "Displays current network connection and IP address",
    "description_pl": "Wyświetla aktualne połączenie sieciowe i adres IP",
    "description_en": "Displays current network connection and IP address",
    "version": "1.0.0",
    "author": "TCE Launcher",
    "update_interval": 10
}
</code></pre>

<p><strong>Plik: <code>data/statusbar_applets/network_status/main.py</code></strong></p>

<pre><code>"""
Aplet statusu sieci paska statusu

Wyświetla aktualny typ połączenia sieciowego i adres IP w pasku statusu.
Po aktywacji pokazuje wszystkie interfejsy sieciowe z ich adresami.
"""

import os
import sys
import socket

# Dodaj katalog główny TCE do ścieżki
APPLET_DIR = os.path.dirname(os.path.abspath(__file__))
TCE_ROOT = os.path.abspath(os.path.join(APPLET_DIR, '..', '..', '..'))
if TCE_ROOT not in sys.path:
    sys.path.insert(0, TCE_ROOT)

from src.titan_core.translation import set_language
from src.settings.settings import get_setting

# Inicjalizacja tłumaczeń
_ = set_language(get_setting('language', 'pl'))

try:
    import psutil
    HAS_PSUTIL = True
except ImportError:
    HAS_PSUTIL = False


def get_statusbar_item_info():
    """
    Zwróć metadane apletu.

    Returns:
        dict: Informacje o aplecie z polami 'name' i 'update_interval'
    """
    return {
        "name": _("Sieć"),
        "update_interval": 10
    }


def _get_local_ip():
    """
    Pobierz podstawowy lokalny adres IP łącząc się z zewnętrznym hostem.

    Returns:
        str: Lokalny adres IP lub "N/D" jeśli niedostępny
    """
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.settimeout(1)
        s.connect(("8.8.8.8", 80))
        ip = s.getsockname()[0]
        s.close()
        return ip
    except Exception:
        return "N/D"


def _get_connection_type():
    """
    Określ aktywny typ połączenia sieciowego (Wi-Fi, Ethernet lub Rozłączony).

    Returns:
        str: Nazwa typu połączenia
    """
    if not HAS_PSUTIL:
        return _("Nieznany")

    try:
        stats = psutil.net_if_stats()
        for iface_name, iface_stats in stats.items():
            if not iface_stats.isup:
                continue
            if iface_name.startswith("lo") or iface_name == "Loopback Pseudo-Interface 1":
                continue

            name_lower = iface_name.lower()
            if "wi-fi" in name_lower or "wlan" in name_lower or "wireless" in name_lower:
                return _("Wi-Fi")
            elif "ethernet" in name_lower or "eth" in name_lower:
                return _("Ethernet")

        # Sprawdź czy jakikolwiek interfejs nie-loopback jest aktywny
        for iface_name, iface_stats in stats.items():
            if iface_stats.isup and not iface_name.startswith("lo") and iface_name != "Loopback Pseudo-Interface 1":
                return _("Połączony")

        return _("Rozłączony")
    except Exception:
        return _("Nieznany")


def get_statusbar_item_text():
    """
    Zwróć typ połączenia sieciowego i IP dla paska statusu.

    Returns:
        str: Tekst statusu sieci (np. "Sieć: Wi-Fi 192.168.1.10")
    """
    try:
        conn_type = _get_connection_type()
        ip = _get_local_ip()

        if ip == "N/D":
            return _("Sieć: {type} (brak IP)").format(type=conn_type)

        return _("Sieć: {type} {ip}").format(type=conn_type, ip=ip)
    except Exception as e:
        print(f"Error getting network information: {e}")
        return _("Sieć: Błąd")


def on_statusbar_item_activate(parent_frame=None):
    """
    Pokaż wszystkie interfejsy sieciowe i ich adresy po aktywacji.

    Args:
        parent_frame: wx.Frame dla okien dialogowych GUI (None dla trybu konsoli/niewidzialnego)
    """
    try:
        lines = []
        lines.append(_("Interfejsy sieciowe:"))
        lines.append("")

        if HAS_PSUTIL:
            addrs = psutil.net_if_addrs()
            stats = psutil.net_if_stats()

            for iface_name in sorted(addrs.keys()):
                iface_stats = stats.get(iface_name)
                status = _("Aktywny") if iface_stats and iface_stats.isup else _("Nieaktywny")
                speed = iface_stats.speed if iface_stats else 0

                lines.append(_("{name} [{status}]").format(
                    name=iface_name,
                    status=status
                ))

                if speed &gt; 0:
                    lines.append(_("  Prędkość: {speed} Mbps").format(speed=speed))

                for addr in addrs[iface_name]:
                    if addr.family == socket.AF_INET:
                        lines.append(_("  IPv4: {address}").format(address=addr.address))
                    elif addr.family == socket.AF_INET6:
                        lines.append(_("  IPv6: {address}").format(address=addr.address))

                lines.append("")
        else:
            ip = _get_local_ip()
            hostname = socket.gethostname()
            lines.append(_("Hostname: {hostname}").format(hostname=hostname))
            lines.append(_("Lokalny IP: {ip}").format(ip=ip))
            lines.append("")
            lines.append(_("Zainstaluj psutil dla szczegółowych informacji o interfejsach."))

        message = "\n".join(lines)

        if parent_frame:
            import wx
            wx.MessageBox(
                message,
                _("Status sieci"),
                wx.OK | wx.ICON_INFORMATION,
                parent_frame
            )
        else:
            print(message)

    except Exception as e:
        print(f"Error showing network details: {e}")
        import traceback
        traceback.print_exc()
</code></pre>

<h2 id="struktura-katalogow">Struktura katalogów</h2>

<pre><code>data/statusbar_applets/nazwa_apletu/
├── applet.json          # Metadane (nazwa, opis, update_interval)
└── main.py              # Implementacja z wymaganymi funkcjami
</code></pre>

<h2 id="testowanie-apletow">Testowanie apletów</h2>

<ol>
<li>Umieść aplet w <code>data/statusbar_applets/nazwa_apletu/</code></li>
<li>Upewnij się że oba pliki <code>applet.json</code> i <code>main.py</code> istnieją</li>
<li>Uruchom Titan</li>
<li>Tekst apletu powinien pojawić się w pasku statusu</li>
<li>Dwukliknij lub aktywuj element paska statusu aby przetestować dialog aktywacji</li>
</ol>

<h2 id="przykład-referencyjny">Przykład referencyjny</h2>

<p>Sprawdź <code>data/statusbar_applets/system_information/main.py</code>:
- Używa <code>psutil</code> dla CPU/RAM/dysku
- <code>get_statusbar_item_text()</code> zwraca sformatowany string
- <code>on_statusbar_item_activate()</code> otwiera szczegółowy wx.MessageBox
- Używa <code>set_language()</code> dla przetłumaczonych wyjść</p>

<h2 id="najwazniejsze-wskazowki">Najważniejsze wskazówki</h2>

<ol>
<li><strong>ZAWSZE zwracaj string</strong> z <code>get_statusbar_item_text()</code> — nigdy nie rzucaj wyjątku</li>
<li><strong>Trzymaj funkcję szybką</strong> — poniżej 2 sekund (preferowane &lt; 500ms)</li>
<li><strong>Cachuj kosztowne operacje</strong> — nie pobieraj danych sieciowych przy każdym wywołaniu</li>
<li><strong>Używaj <code>interval=0.1</code></strong> dla psutil.cpu_percent() zamiast blokującego <code>interval=1</code></li>
<li><strong>Obsługuj gracefully brak zależności</strong> — sprawdź czy psutil/inne biblioteki są dostępne</li>
<li><strong>Testuj w wielu trybach</strong> — GUI, Invisible UI i Klango</li>
<li><strong>Używaj tłumaczeń</strong> - <code>set_language()</code> dla wszystkich stringów użytkownika</li>
<li><strong>Implementuj <code>on_statusbar_item_activate()</code> dla szczegółów</strong> — użytkownicy lubią więcej informacji!</li>
</ol>

<p>Aplety paska statusu umożliwiają dodawanie dynamicznych informacji do interfejsu Titan bez modyfikowania kodu głównego. Dzięki prostemu API każdy może stworzyć własny aplet wyświetlający przydatne dane w czasie rzeczywistym.</p>

            <a href="#" class="back-to-top" title="Powrót na górę">↑</a>
        </main>
    </div>
</body>
</html>
